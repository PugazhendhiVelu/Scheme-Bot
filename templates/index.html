<!DOCTYPE html>
<html>
<head>
    <title>Chatbot</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <style>
        body {
            background-image: url('https://www.cumanagement.com/sites/default/files/2021-08/hand-chatbot-technology-background.jpg'); /* Replace with your background image URL */
            background-size: cover; /* Cover the entire container */
            background-position: center; /* Center the background image */
        }
    </style>
</head>

<body>
    <div class="container-fluid h-100">
        <div class="row justify-content-center h-100">        
            <div class="col-md-8 col-xl-6 chat">
                <div class="card">
                    <div class="card-header msg_head">
                        <div class="d-flex bd-highlight">
                            <div class="img_cont">
                                <img src="https://i.ibb.co/fSNP7Rz/icons8-chatgpt-512.png" class="rounded-circle user_img" style="width: 20px; height: 25px;">
                                <span class="online_icon"></span>
                            </div>
                            <div class="user_info">
                                <span style="align-self: center; text-align: center;">ChatBot</span>
                                <p>Ask me anything!</p>
                            </div>
                            <div class="ml-auto">
                                <button type="button" id="clearChat" class="btn btn-danger btn-sm"><i class="fas fa-trash-alt"></i> Clear Chat</button>
                                <button type="button" id="profile" class="btn btn-primary btn-sm ml-2"><i class="fas fa-user"></i></button>
                            </div>
                        </div>
                    </div>
                    <div id="messageFormeight" class="card-body msg_card_body" style="overflow-y: auto; max-height: 400px;">
                        <!-- Message body content -->
                    </div>
                    <div class="card-footer">
                        <form id="messageArea" class="input-group">
                            <input type="text" id="text" name="msg" placeholder="Type your message..." autocomplete="off" class="form-control type_msg" required/>
                            <div class="input-group-append">
                                <button type="button" id="send" class="input-group-text send_btn"><i class="fas fa-location-arrow"></i></button>
                                <button type="button" id="voice" class="input-group-text voice_btn"><i class="fas fa-microphone"></i></button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
    // Initialize SpeechRecognition object
    var recognition = new webkitSpeechRecognition();
    recognition.continuous = false;
    recognition.interimResults = false;
    recognition.lang = "en-US";

    // Variable to track whether recognition is active
    var isRecognitionActive = false;

    // Function to start speech recognition
    function startRecognition() {
        recognition.start();
        isRecognitionActive = true;
        // Update microphone button icon
        $("#voice i").removeClass("fa-microphone").addClass("fa-microphone-slash");
    }

    // Function to stop speech recognition
    function stopRecognition() {
        recognition.stop();
        isRecognitionActive = false;
        // Update microphone button icon
        $("#voice i").removeClass("fa-microphone-slash").addClass("fa-microphone");
    }

    // Event listener for voice button click
    $("#voice").on("click", function() {
        if (isRecognitionActive) {
            stopRecognition();
        } else {
            startRecognition();
        }
    });

    // Event listener for speech recognition result
    recognition.onresult = function(event) {
        var transcript = event.results[0][0].transcript;
        $("#text").val(transcript); // Update the input field with recognized text
        // Do not submit the form automatically
    };

    // Event listener for speech recognition error
    recognition.onerror = function(event) {
        console.error('Speech recognition error:', event.error);
        stopRecognition();
    };

    // Event listener for form submission when "Enter" is pressed
    $("#text").on("keypress", function(event) {
        // Check if the pressed key is "Enter"
        if (event.which === 13) {
            // Prevent the default form submission behavior
            event.preventDefault();
            
            // Trigger the form submission
            $("#messageArea").submit();
        }
    });

    // Event listener for form submission when the "Send" button is clicked
    $("#send").on("click", function(event) {
        // Prevent the default form submission behavior
        event.preventDefault();
        
        // Trigger the form submission
        $("#messageArea").submit();
    });

    // Event listener for form submission
    $("#messageArea").on("submit", function(event) {
        // Prevent the default form submission behavior
        event.preventDefault();
        
        // Get the raw text from the input field
        var rawText = $("#text").val();

        // If the input field is not empty
        if (rawText.trim() !== "") {
            // Construct HTML for user message
            var userHtml = '<div class="d-flex justify-content-end mb-4"><div class="msg_cotainer_send">' + rawText + '</div><div class="img_cont_msg"><img src="https://cdn-icons-png.freepik.com/256/10302/10302971.png?semt=ais_hybrid" class="rounded-circle user_img_msg" style="width: 40px; height: 40px;"></div></div>';
            
            // Clear the input field
            $("#text").val("");
            
            // Append user message to chat box and scroll to input
            appendMessageAndScroll(userHtml);

            // Send the user message to the server via AJAX
            $.ajax({
                data: {
                    msg: rawText,
                },
                type: "POST",
                url: "/get",
            }).done(function(data) {
                // Construct HTML for bot message
                var botHtml = '<div class="d-flex justify-content-start mb-4"><div class="img_cont_msg"><img src="https://media.istockphoto.com/id/1010001882/vector/%C3%B0%C3%B0%C2%B5%C3%B1%C3%B0%C3%B1%C3%B1.jpg?s=612x612&w=0&k=20&c=1jeAr9KSx3sG7SKxUPR_j8WPSZq_NIKL0P-MA4F1xRw=" class="rounded-circle user_img_msg" style="width: 40px; height: 40px;"></div><div class="msg_cotainer">' + data + '</div></div>';
                
                // Append bot message to chat box and scroll to input
                appendMessageAndScroll(botHtml);
            }).fail(function() {
                // Construct HTML for error message
                var errorHtml = '<div class="d-flex justify-content-start mb-4"><div class="msg_cotainer">' + "Error occurred while processing the request." + '</div></div>';
                
                // Append error message to chat box and scroll to input
                appendMessageAndScroll(errorHtml);
            });
        }
    });

    // Function to scroll to the input area
    function scrollToInput() {
        var chatBox = $("#messageFormeight");
        var scrollHeight = chatBox.prop("scrollHeight");
        chatBox.scrollTop(scrollHeight);
    }

    // Function to append message to chat box and scroll to input
    function appendMessageAndScroll(messageHtml) {
        $("#messageFormeight").append(messageHtml);
        scrollToInput();
    }

    // Event listener for clear chat button click
    $("#clearChat").on("click", function() {
        $("#messageFormeight").empty();
    });

    // Event listener for profile button click
    $("#profile").on("click", function() {
        // Add your profile button click functionality here
        alert("Profile button clicked!");
    });
</script>


</body>
</html>

